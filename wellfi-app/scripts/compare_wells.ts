import fs from 'fs';

// Extract all well_ids from the batch SQL files
const batchIds = new Set<string>();
for (let b = 1; b <= 5; b++) {
  const sql = fs.readFileSync(`supabase/batches/batch_${String(b).padStart(3,'0')}.sql`, 'utf8');
  // Each well INSERT starts with the well_id as the first value
  const matches = sql.matchAll(/VALUES\s*\(\s*'([^']+)'/g);
  for (const m of matches) {
    batchIds.add(m[1]);
  }
}

console.log(`Wells in batch files: ${batchIds.size}`);

// The 211 well_ids from Supabase
const supabaseIds = new Set([
  "100010608013W502","100010808215W500","100011308218W509","100011608114W509","100011708317W509",
  "100011908318W509","100012908218W509","100013208319W509","100013308218W509","100020108318W502",
  "100021608216W509","100021808217W509","100021908317W509","100022008318W509","100023208318W509",
  "100023208319W509","100023508218W509","100031308218W509","100031608216W509","100032008318W509",
  "100033208217W509","100033208318W509","100033208319W509","100040108318W509","100040508317W502",
  "100040608317W502","100040708317W509","100040908012W500","100040908013W500","100041308218W509",
  "100041908318W509","100042908318W500","100043008318W509","100043208319W509","100053108318W509",
  "100060808215W508","100061908318W509","100062408218W503","100080508215W500","100080808215W500",
  "100081408117W509","100081808013W500","100081908217W509","100082708218W509","100082908218W509",
  "100083108319W509","100083308218W509","100083408218W509","100090608316W509","100091808216W509",
  "100092608415W507","100092908318W509","100093108318W509","100093108319W509","100101508013W500",
  "100101808216W509","100103108319W509","100112608218W500","100120407815W502","100121507815W500",
  "100121808216W509","100121908217W509","100123508218W509","100130508317W509","100131708317W509",
  "100131808317W509","100131908317W509","100132708415W508","100132908216W509","100133008216W509",
  "100140808317W509","100141708317W509","100141808216W509","100141808317W509","100142208419W509",
  "100142408419W500","100143008216W509","100143008318W502","100143508218W509","100150108318W509",
  "100150708317W509","100151208317W509","100151208318W502","100151908217W509","100151908317W509",
  "100151908318W509","100152408419W500","100152608117W508","100152608218W500","100153108217W509",
  "100160508215W500","100160508317W509","100160608316W509","100160808215W500","100160808218W509",
  "100160808317W509","100161008218W509","100161208317W509","100161208318W509","100161508216W509",
  "100161808516W509","100162208419W509","100162408419W500","100162608415W500","100162908318W509",
  "100163008216W509","100163108318W509","100163408218W509","100163408318W509","100163508218W509",
  "102011308218W509","102013108217W509","102020108318W508","102021908318W509","102022008316W509",
  "102032308419W509","102033208217W509","102040508317W509","102041108114W509","102042008318W509",
  "102043208318W509","102052408218W502","102060108216W503","102062408218W509","102082508218W509",
  "102082708218W509","102092308218W509","102103608218W509","102113608218W509","102122408218W509",
  "102123608218W509","102132208419W509","102133108318W509","102140708317W509","102141908317W509",
  "102142408419W500","102143008216W509","102143008318W509","102143108217W509","102143408318W509",
  "102143508218W509","102150708317W509","102151908217W509","102153008216W509","102153108217W509",
  "102160808215W500","102161808317W509","102162108419W509","102163008216W509","102163008318W509",
  "103010508215W509","103012708218W509","103032608218W509","103043108318W509","103052408218W502",
  "103080808215W500","103082408218W509","103090508215W500","103090808215W500","103113608218W509",
  "103123608218W509","103131908217W509","103132208419W509","103133408318W509","103142408419W500",
  "103143008318W509","103143108217W509","103143408318W509","103151908217W509","103153008216W509",
  "103160808215W500","103162908115W506","104020808317W509","104041808217W509","104051308218W509",
  "104052408218W509","104052508419W509","104080508215W509","104083208115W509","104090808215W500",
  "104092908115W506","104093508218W509","104093608218W509","104113608218W509","104123608218W509",
  "104131908217W509","104132308419W509","104141908217W509","104152308419W509","104152408419W500",
  "104160808215W509","104162308419W508","104162408419W508","105090808215W507","105132408419W509",
  "105132508419W509","105142408419W509","105163208115W509","106010808215W505","106042508419W508",
  "106080508215W509","106093208115W507","106132508419W508","108160508215W506","1S0013008217W509",
  "1S0032908217W509","1S0042908217W509","1W0043308318W502","1W0130808317W509","1W0132408419W500",
  "1W0133108217W509"
]);

console.log(`Wells in Supabase: ${supabaseIds.size}`);

// Find wells in Supabase NOT in batch files (orphaned)
const orphaned = [...supabaseIds].filter(id => !batchIds.has(id));
console.log(`\nIn Supabase but NOT in batch files (${orphaned.length}):`);
orphaned.forEach(id => console.log(' ', id));

// Find wells in batch files NOT in Supabase (missing)
const missing = [...batchIds].filter(id => !supabaseIds.has(id));
console.log(`\nIn batch files but NOT in Supabase (${missing.length}):`);
missing.forEach(id => console.log(' ', id));

console.log(`\nSummary: Supabase=${supabaseIds.size}, Batches=${batchIds.size}, Orphaned=${orphaned.length}, Missing=${missing.length}`);
